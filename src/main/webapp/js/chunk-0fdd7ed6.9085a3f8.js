(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0fdd7ed6"],{"0d36":function(t,e,n){"use strict";var i=n("57b8"),o=n.n(i);o.a},3050:function(t,e,n){},"57b8":function(t,e,n){},"7e0a":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoadingDocumentDetails,expression:"isLoadingDocumentDetails"}],staticStyle:{position:"absolute",left:"50%",top:"50%"}}),n("transition",{attrs:{name:"el-zoom-in-center",mode:"out-in"}},[!t.isLoadingDocumentDetails&&t.isShowDocumentDetails?n("el-card",{key:"showDocumentDetails",staticClass:"card"},[n("div",{staticClass:"clearfix",staticStyle:{"text-align":"center"},attrs:{slot:"header"},slot:"header"},[n("div",{staticClass:"handle",staticStyle:{float:"left"},on:{click:t.goBack}},[n("i",{staticClass:"el-icon-arrow-left"}),t._v(" 返回上级\n                ")]),n("div",{staticClass:"handle",staticStyle:{float:"right"},on:{click:t.handleDetailsOrComments}},[t._v("\n                    查看评论"),n("i",{staticClass:"el-icon-arrow-right"}),t._v(" \n                ")]),n("span",[t._v(t._s(t.document.name))])]),n("div",{staticClass:"img"},[n("img",{attrs:{src:t.document.icon}})]),n("div",{staticClass:"content"},[n("div",{staticClass:"intro"},[n("span",{staticStyle:{"font-size":"22px","font-weight":"bold"}},[t._v("简介: ")]),n("span",{staticClass:"meta",domProps:{innerHTML:t._s(t.simpleIntro)}}),t.introFlag?n("span",{staticClass:"more",on:{click:function(e){t.isShowAllIntro=!t.isShowAllIntro}}},[t._v(t._s(this.showMore))]):t._e()]),n("table",{staticClass:"meta"},[n("tr",[n("td",{staticClass:"left"},[t._v("文件类型：\n                        ")]),n("td",{staticStyle:{width:"auto"}},[t._v(t._s(t.document.formatName))])]),n("tr",[n("td",{staticClass:"left"},[t._v("文件大小：\n                        ")]),n("td",{staticStyle:{width:"auto"}},[t._v(t._s(t.document.size))])]),n("tr",[n("td",{staticClass:"left"},[t._v("上传者：\n                        ")]),n("td",{staticStyle:{width:"auto"}},[t._v(t._s(t.document.uploaderName))])]),n("tr",[n("td",{staticClass:"left"},[t._v("上传时间：\n                        ")]),n("td",{staticStyle:{width:"auto"}},[t._v(t._s(t.document.uploadTime))])]),n("tr",[n("td",{staticClass:"left"},[t._v("最后更新时间：\n                        ")]),n("td",{staticStyle:{width:"auto"}},[t._v(t._s(t.document.lastUpdateTime))])]),n("tr",[n("td",{staticClass:"left"},[t._v("下载量：\n                        ")]),n("td",{staticStyle:{width:"auto"}},[t._v(t._s(t.document.downloadNum))])]),n("tr",{staticStyle:{height:"40px"}},[n("td",{staticClass:"left",staticStyle:{width:"auto"},attrs:{colspan:"2"}},[t.document.key1?n("el-tag",{staticStyle:{"margin-right":"14px"},attrs:{type:"success"}},[t._v("\n                                "+t._s(t.document.key1)+"\n                            ")]):t._e(),t.document.key2?n("el-tag",{staticStyle:{"margin-right":"14px"},attrs:{type:"warning"}},[t._v("\n                                "+t._s(t.document.key2)+"\n                            ")]):t._e(),t.document.key3?n("el-tag",{attrs:{type:"danger"}},[t._v(t._s(t.document.key3))]):t._e()],1)])]),n("OnlinePreviewButton",{attrs:{documentUrl:t.document.url,isPrivate:t.isPrivate,documentId:t.document.id,formatName:t.document.formatName}})],1)]):t._e(),t.isLoadingDocumentDetails||t.isShowDocumentDetails?t._e():n("el-card",{key:"showDocumentComments",staticClass:"card"},[n("div",{staticClass:"clearfix",staticStyle:{"text-align":"center"},attrs:{slot:"header"},slot:"header"},[n("div",{staticClass:"handle",staticStyle:{float:"left"},on:{click:t.handleDetailsOrComments}},[n("i",{staticClass:"el-icon-arrow-left"},[t._v("查看文件")]),t._v(" \n                ")]),n("span",[t._v("文件评论")])]),t.firstLevel&&0!=t.firstLevel.length?n("div",[t._l(t.firstLevel,function(e,i){return n("div",{staticStyle:{"border-bottom":"1px dashed #e0e0e0",padding:"5px 5px 5px 0"}},[n("DocumentCommentsItem",{attrs:{item:e,documentId:t.document.id,userId:t.userId,isFirstLevel:!0,index:i},on:{openMsg:t.receiveOpenMsg}}),n("DocumentCommentsTree",{directives:[{name:"show",rawName:"v-show",value:e.data.levelShow,expression:"item.data.levelShow"}],attrs:{comments:e.children,documentId:t.document.id,userId:t.userId}})],1)}),n("div",{directives:[{name:"show",rawName:"v-show",value:t.documentComment.total>t.pageSize,expression:"documentComment.total > pageSize"}],staticStyle:{margin:"10px 0"}},[n("el-pagination",{attrs:{"current-page":t.documentComment.currentPage,"page-size":t.pageSize,layout:"total, prev, pager, next",total:t.documentComment.total},on:{"current-change":t.handleCurrentChange,"update:currentPage":function(e){return t.$set(t.documentComment,"currentPage",e)},"update:current-page":function(e){return t.$set(t.documentComment,"currentPage",e)}}})],1)],2):n("div",{staticStyle:{"text-align":"center",margin:"50px",color:"#909399"}},[t._v("\n                该文件暂无评论\n            ")]),n("div",{staticStyle:{float:"bottom","margin-top":"36px"}},[n("el-input",{staticStyle:{margin:"5px 0"},attrs:{placeholder:"不大于50个字符！",maxlength:"50"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.listenReplayDocument(e)}},model:{value:t.remark_document,callback:function(e){t.remark_document=e},expression:"remark_document"}}),n("el-checkbox",{staticStyle:{margin:"5px 0"},model:{value:t.isIdentify,callback:function(e){t.isIdentify=e},expression:"isIdentify"}},[t._v("匿名")]),n("el-button",{staticStyle:{float:"right",margin:"5px 0"},attrs:{type:"primary"},on:{click:t.replayDocument}},[t._v("发布评论\n                ")])],1)])],1)],1)},o=[],s=(n("3050"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.preview}},[t._v("在线预览")]),t.isPrivate&&"markdown"==t.formatName?n("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.edit}},[t._v("在线编辑\n    ")]):t._e(),n("el-button",{attrs:{type:"primary",size:"small",plain:""},on:{click:t.download}},[t._v("下载文件")])],1)}),a=[],c={name:"OnlinePreviewButton",props:["isPrivate","formatName","documentId","documentType","documentUrl"],data:function(){return{buttonText:"",isVisible:!1}},created:function(){},methods:{preview:function(){var t=this.$router.resolve({name:"documentOnlinePreview",path:"/documentOnlinePreview",query:{documentId:this.documentId}});this.open(t)},edit:function(){var t=this.$router.resolve({name:"MarkdownEditor",path:"/MarkdownEditor",query:{documentId:this.documentId}});this.open(t)},open:function(t){var e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,n=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;n=5*n/6,e=5*e/6,window.open(t.href,"_blank","height="+n+",width="+e+",top=80,left=80,toolbar=no, menubar=no, scrollbars=yes, resizable=yes")},download:function(){this.documentUrl&&window.open(this.documentUrl,"_blank")}}},r=c,m=n("17cc"),l=Object(m["a"])(r,s,a,!1,null,"8597ba40",null),u=l.exports,d=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{"margin-left":"20px","text-align":"left","font-size":"14px"}},t._l(t.comments,function(e){return t.comments.length>0?n("div",[n("DocumentCommentsItem",{attrs:{item:e,documentId:t.documentId,userId:t.userId}}),e.children&&e.children.length>0?n("DocumentCommentsTree",{staticClass:"tree",attrs:{comments:e.children,documentId:t.documentId,userId:t.userId}}):t._e()],1):t._e()}),0)},h=[],p=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{margin:"10px 0"}},[n("div",{class:t.isFirstLevel?"firstItem":"item",on:{mouseenter:t.handleShowOperation,mouseleave:t.handleShowOperation}},[n("span",[t._v(t._s(t.item.data.userName)+" :")]),n("span",{staticStyle:{color:"#606266"}},[t._v(t._s(t.item.data.content))]),n("span",{staticStyle:{color:"#909399","font-size":"12px"}},[t._v("("+t._s(t.item.data.remarkDate)+")")]),n("span",[n("a",{directives:[{name:"show",rawName:"v-show",value:t.isShowOperation,expression:"isShowOperation"}],on:{click:t.handleShowInput}},[t._v(t._s(t.isShowInput?"关闭":"评论"))])]),n("span",[n("a",{directives:[{name:"show",rawName:"v-show",value:t.isFirstLevel&&t.isShowOperation,expression:"isFirstLevel && isShowOperation"}],on:{click:t.handleOpen}},[t._v(t._s(t.isOpen?"收起回复":"查看回复"))])])]),n("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowInput,expression:"isShowInput"}],staticStyle:{margin:"0 50px 0 20px"}},[n("el-input",{directives:[{name:"show",rawName:"v-show",value:t.isShowInput,expression:"isShowInput"}],staticStyle:{margin:"5px 0"},attrs:{placeholder:"不大于50个字符！",maxlength:"50"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.listenReplyComments(e)}},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}}),n("el-checkbox",{staticStyle:{margin:"5px 0"},model:{value:t.isIdentify,callback:function(e){t.isIdentify=e},expression:"isIdentify"}},[t._v("匿名")]),n("el-button",{staticStyle:{float:"right",margin:"5px 0"},attrs:{type:"primary"},on:{click:t.replyComments}},[t._v("发布评论\n        ")])],1)])},v=[],f=n("7f43"),g=n.n(f),y=n("6bf2"),w=n.n(y),S=n("0ec7"),I=n.n(S),_={name:"DocumentCommentsItem",props:["item","documentId","userId","isFirstLevel","index"],components:{DocumentCommentsTree:N},data:function(){return{isIdentify:!1,content:"",isOpen:!1,isShowInput:!1,isShowOperation:!1}},methods:{handleOpen:function(){this.isOpen=!this.isOpen;var t=[];t.push(this.index),t.push(this.isOpen),this.$emit("openMsg",t)},handleShowInput:function(){this.isShowInput=!this.isShowInput},handleShowOperation:function(){this.isShowOperation=!this.isShowOperation},listenReplyComments:function(t){return this.replyComments(),t.preventDefault(),!1},replyComments:function(){var t=this,e={};e.isIdentify=this.isIdentify,e.isSecond=!!this.isFirstLevel,e.document=this.documentId,e.commentId=this.item.data.id,e.content=this.content,e.commentator=this.userId,e.remarkDate=w()().utc().format("YYYY-MM-DD"),e.id=null,g.a.post("/IGSDN/replyDocumentComments",{documentComment2:JSON.stringify(e)}).then(function(e){e.data?(I.a.publish("isCommentSuccess",!0),t.isShowInput=!1,t.isShowOperation=!1,t.content="",t.$message({message:"评论成功",type:"success"})):t.$message({message:"评论失败",type:"error"})}).catch(function(t){})}}},D=_,C=(n("0d36"),Object(m["a"])(D,p,v,!1,null,"67391000",null)),k=C.exports,x={name:"DocumentCommentsTree",props:["comments","documentId","userId"],components:{DocumentCommentsItem:k},mounted:function(){},data:function(){return{}},methods:{}},b=x,O=Object(m["a"])(b,d,h,!1,null,"97afd488",null),N=O.exports,P={components:{OnlinePreviewButton:u,DocumentCommentsTree:N,DocumentCommentsItem:k},data:function(){return{isPrivate:!1,isShowDocumentDetails:!0,isLoadingDocumentDetails:!0,isShowAllIntro:!1,introFlag:!0,document:{},documentInit:{id:0,name:"",size:"",uploadTime:"",lastUpdateTime:"",icon:"",key1:"",key2:"",key3:"",formatId:0,formatName:"",url:"",uploaderId:0,uploaderName:"",intro:"",downloadNum:0},remark_document:"",isIdentify:!1,userId:0,message:"",pageSize:10,isShow:!1,activeName:"1",firstLevel:[],documentComment:{},isShowInput:!1,isShowOperation:!1,promptFlag:!1}},mounted:function(){var t=this;this.isShowDocumentDetails=!0,this.document=this.documentInit,this.document.id=this.$route.params.documentId,this.isPrivate=this.$route.params.isPrivate,this.userId=JSON.parse(localStorage.getItem("user_msg")).id,this.selectDocumentCommentByPageNum(1),this.getDocumentDetails(),I.a.subscribe("isCommentSuccess",function(e,n){if(console.log(n),n){var i=t.documentComment.currentPage;i=i||1,t.selectDocumentCommentByPageNum(i)}})},watch:{$route:function(){this.isShowDocumentDetails=!0,this.document=this.documentInit,this.document.id=this.$route.params.documentId,this.isPrivate=this.$route.params.isPrivate,this.getDocumentDetails(),this.selectDocumentCommentByPageNum(1)}},methods:{goBack:function(){this.$router.go(-1)},getDocumentDetails:function(){var t=this,e=this.document.id;e&&0!=e&&(this.isLoadingDocumentDetails=!0,g.a.get("/IGSDN/getDocumentDetails/"+e).then(function(e){t.isShowDocumentDetails=!0,t.document=e.data,t.document.icon?t.document.icon="data:image/jpg;base64,"+t.document.icon:t.document.icon=localStorage.getItem("icon-"+t.document.formatId),t.isLoadingDocumentDetails=!1}).catch(function(e){t.isLoadingDocumentDetails=!1,console.log(e)}))},handleDetailsOrComments:function(){this.isShowDocumentDetails=!this.isShowDocumentDetails},handleCurrentChange:function(t){this.selectDocumentCommentByPageNum(t)},selectDocumentCommentByPageNum:function(t){var e=this,n=this.document.id,i=this.userId,o=this.pageSize;if(n&&0!=n){var s=t;g.a.post("/IGSDN/listDocumentComments",{userId:i,documentId:n,pageNum:s,pageSize:o}).then(function(t){e.documentComment=t.data,e.firstLevel=e.documentComment.data}).catch(function(t){})}},listenReplayDocument:function(t){return this.replayDocument(),t.preventDefault(),!1},replayDocument:function(){var t=this;this.promptFlag||(this.promptFlag=!0,this.$confirm("确认发布评论？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var e=t.document.uploaderId;if(e!=t.userId){var n={};n.document=t.document.id,n.content=t.remark_document,n.commentator=t.userId,n.remarkDate=w()().utc().format("YYYY-MM-DD"),n.isIdentify=t.isIdentify,n.id=null,g.a.post("/IGSDN/remarkDocument",{document:JSON.stringify(n)}).then(function(e){if(e.data){t.remark_document="",t.promptFlag=!1;var n=t.documentComment.currentPage;t.firstLevel.length==t.pageSize&&n++,t.selectDocumentCommentByPageNum(n),t.$message({message:"评论成功",type:"success"})}else t.promptFlag=!1,t.$message({message:"评论失败",type:"error"})}).catch(function(t){})}else t.$message({message:"抱歉，这是你自己发布的文件",type:"error"})}).catch(function(){}))},receiveOpenMsg:function(t){var e=t[0],n=t[1];this.firstLevel[e].data.levelShow=n}},computed:{simpleIntro:function(){if(this.isShowAllIntro)return this.document.intro;var t=this.document.intro;return t&&(this.introFlag=t.length>160,t=this.introFlag?t.substring(0,160)+"...":t),t},showMore:function(){return this.isShowAllIntro?"关闭":"展开"}}},L=P,$=(n("de36"),Object(m["a"])(L,i,o,!1,null,"8547ed24",null));e["default"]=$.exports},de36:function(t,e,n){"use strict";var i=n("ff75"),o=n.n(i);o.a},ff75:function(t,e,n){}}]);