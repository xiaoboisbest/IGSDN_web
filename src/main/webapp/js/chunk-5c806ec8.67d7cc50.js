(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5c806ec8"],{"653c":function(t,e,i){},a1f7:function(t,e,i){"use strict";var a=i("653c"),s=i.n(a);s.a},a727:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-card",{staticClass:"box-card",staticStyle:{width:"800px",margin:"0 auto"}},[i("el-form",{ref:"form",attrs:{model:t.form,"label-width":"80px"}},[i("el-form-item",{attrs:{label:"选择文件"}},[i("div",{staticStyle:{float:"left"}},[i("el-upload",{staticClass:"upload-demo",attrs:{action:"1","http-request":t.getFile,"show-file-list":!1,drag:"",multiple:""}},[i("i",{staticClass:"el-icon-upload"}),i("div",{staticClass:"el-upload__text"},[t._v("\n                        可将文件拖到此处\n                        "),i("div",{staticStyle:{color:"#909399","font-size":"12px"}},[t._v("说明：文件大小限制为200MB")])])])],1)]),i("el-form-item",{attrs:{label:"文件名称"}},[i("el-input",{model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),i("el-form-item",{attrs:{label:"文件格式"}},[i("el-input",{attrs:{disabled:!0},model:{value:t.form.format,callback:function(e){t.$set(t.form,"format",e)},expression:"form.format"}})],1),i("el-form-item",{attrs:{label:"所属分类"}},[i("el-cascader",{attrs:{options:t.options,props:t.optionProps,"show-all-levels":!1},on:{change:t.handleChange}})],1),i("el-form-item",{attrs:{label:"文件权限"}},[i("el-radio-group",{model:{value:t.isPublic,callback:function(e){t.isPublic=e},expression:"isPublic"}},[i("el-radio",{attrs:{label:"公有",checked:""}}),i("el-radio",{attrs:{label:"私有"}})],1)],1),i("el-form-item",{attrs:{label:"添加标签"}},[i("el-input",{attrs:{placeholder:"不能超过10个字符"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.intoTags(e)}},model:{value:t.tagsContent,callback:function(e){t.tagsContent=e},expression:"tagsContent"}}),t._l(t.tags,function(e,a){return null!==e.name?i("el-tag",{key:a,staticStyle:{margin:"10px 10px 0 0"},attrs:{closable:"",type:e.type},on:{close:function(e){return t.handleCloseTag(a)}}},[t._v("\n                "+t._s(e.name)+"\n            ")]):t._e()})],2),i("el-form-item",{attrs:{label:"文件封面"}},[i("el-upload",{staticClass:"avatar-uploader",attrs:{action:"1","http-request":t.httpRequest,"show-file-list":!1,"on-remove":t.handleRemoveImg}},[t.imageUrl?i("img",{staticClass:"avatar",attrs:{src:t.imageUrl,height:"180px",width:"360px"}}):i("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),i("el-form-item",{attrs:{label:"文件描述"}},[i("el-input",{attrs:{type:"textarea"},model:{value:t.form.desc,callback:function(e){t.$set(t.form,"desc",e)},expression:"form.desc"}})],1),i("el-form-item",[i("el-button",{attrs:{type:"primary",loading:t.isSubmitting,plain:!0},on:{click:t.onSubmit}},[t._v("\n                "+t._s(t.isSubmitting?"提交中...":"提交")+"\n            ")]),i("el-button",{attrs:{type:"danger"},on:{click:t.goBack}},[t._v("返回")])],1)],1)],1)},s=[],o=(i("c30b"),i("528f"),i("fb6a"),i("611e"),i("7f43")),l=i.n(o),n={data:function(){return{isSubmitting:!1,flag:"",tagesFlag:0,tagsContent:"",isPublic:"公有",fileReader2:"",fileList2:[],fileList:[],limitSize:2209715200,isExceedLimitSize:!1,form:{name:"",format:"",file:"",photoBase64:"",isPublic:"",desc:"",tags:[],order:"",formatId:"",size:""},tags:[{name:null,type:""}],imageUrl:"",fileReader:"",options:[],optionProps:{value:"index",label:"title",children:"subs"}}},computed:{},mounted:function(){var t=this;window.FileReader||console.error("Your browser does not support FileReader API!"),this.fileReader=new FileReader;var e=null;l.a.post("/IGSDN/getAllCategoryTree",{preList:e}).then(function(e){t.options=e.data[0]}).catch(function(t){})},methods:{open1:function(t){this.$message.error(t)},handleCloseTag:function(t){this.tags.splice(t,1),this.tagesFlag--},intoTags:function(){if(this.tagsContent.trim().length>10)return this.open1("输入内容太长"),void(this.tagsContent="");if(this.tags.length>3)return this.open1("只能添加三个标签"),void(this.tagsContent="");var t=[{type:"success"},{type:"info"},{type:"danger"}],e={name:"",type:""};e.name=this.tagsContent.trim(),e.type=t[this.tagesFlag].type,this.tags.push(e),this.tagesFlag++,this.tagsContent=""},handleChange:function(t){this.form.order=t[t.length-1]},getFile:function(t){var e=this;this.isExceedLimitSize=!1;var i=t.file;console.log(i);var a=i.name;this.fileList.splice(this.fileList.length),this.fileList.push(i.key),this.form.size=i.size;var s=a.slice(a.lastIndexOf("."),a.length);i.size>this.limitSize?(this.isExceedLimitSize=!0,this.form.name="文件大小不可大于200MB"):this.form.name=a.slice(0,a.lastIndexOf(".")),l.a.post("/IGSDN/getDocumentFormatName",{suffix:s}).then(function(t){""===t.data[1]||null===t.data[1]?(e.form.format="当前处理不了这类文件",e.flag=!1):(e.flag=!0,e.form.format=t.data[1],e.form.formatId=t.data[0])}).catch(function(t){}),i&&this.fileReader.readAsDataURL(i),this.fileReader.onload=function(){var t=e.fileReader.result;e.form.file=t}},onSubmit:function(){var t=this;if(this.form.file)if(this.flag)if(this.form.name)if(this.form.order)if(this.isExceedLimitSize)this.open1("该文件大小超过限制");else if(this.form.desc){var e;e="公有"===this.isPublic;var i="",a="",s="";this.tags[1]&&(i=this.tags[1].name),this.tags[2]&&(a=this.tags[2].name),this.tags[3]&&(s=this.tags[3].name);var o={id:""};o.name=this.form.name,o.isPublic=e,o.uploader=JSON.parse(localStorage.getItem("user_msg")).id,o.format=this.form.formatId,o.size=this.form.size,o.src=this.form.file,o.iconSrc=this.form.photoBase64,o.category=this.form.order,o.intro=this.form.desc,o.key1=i,o.key2=a,o.key3=s,this.isSubmitting=!0,l.a.post("/IGSDN/uploadFile",{document:JSON.stringify(o)}).then(function(e){e.data&&(t.isSubmitting=!1,t.$message({message:"上传成功！",type:"success"}),window.location.reload())}).catch(function(e){t.isSubmitting=!1,t.$message({message:"上传失败！",type:"error"})})}else this.open1("文件描述不可为空");else this.open1("请选择该文件所属类型");else this.open1("文件名称不可为空");else this.open1("当前处理不了这类文件");else this.open1("请选择文件")},httpRequest:function(t){var e=this,i=t.file;console.log(i),this.beforeAvatarUpload(i)?(i&&this.fileReader.readAsDataURL(i),this.fileReader.onload=function(){var t=e.fileReader.result;e.imageUrl=t,e.form.photoBase64=t}):this.$message.error("封面格式必须为图片！")},beforeAvatarUpload:function(t){var e="image"===t.type.split("/")[0];return e},handleRemoveImg:function(t,e){this.imageUrl=""},goBack:function(){this.$router.go(-1)}}},r=n,f=(i("a1f7"),i("17cc")),c=Object(f["a"])(r,a,s,!1,null,"5a714d75",null);e["default"]=c.exports}}]);